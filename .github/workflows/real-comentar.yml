name: Real Comentar web.config

on:

  workflow_dispatch: #

jobs:
  modificar-webconfig:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Run script to modify web.config
      run: |
        # Crear un archivo temporal para almacenar el resultado
        tmpfile=$(mktemp)

        # Variable para detectar si estamos dentro de un bloque ya comentado
        inside_comment=0

        # Variable para contar las ocurrencias de <sessionState>
        count_sessionState=0

        # Procesar el archivo con awk para comentar las líneas necesarias
        awk '
        {
            # Buscar inicio de bloque comentado
            if (/<\!--.*<sessionState/) {
                inside_comment = 1
            }
            
            # Buscar fin de bloque comentado
            if (/sessionState>.*-->/) {
                inside_comment = 0
            }
            
            # Contar las ocurrencias de <sessionState> fuera de bloques comentados
            if (!inside_comment && /<sessionState/) {
                count_sessionState++
            }
            
            # Comentar las líneas que no están dentro de un bloque comentado
            if (!inside_comment && /<sessionState/ && count_sessionState == 2) {
                gsub(/<sessionState/, "<!-- <sessionState")
            }
            
            if (!inside_comment && /sessionState>/ && count_sessionState == 2) {
                gsub(/sessionState>/, "sessionState> -->")
            }
            
            # Imprimir la línea modificada o no modificada
            print $0
        }
        ' web3.config > "$tmpfile"
    - name: Upload modified web.config
      uses: actions/upload-artifact@v2
      with:
        name: web3.config
        path: web3.config
