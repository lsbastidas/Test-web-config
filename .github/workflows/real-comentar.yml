name: Real Comentar web.config

on:

  workflow_dispatch: #

jobs:
  modificar-webconfig:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Run script to modify web.config
      run: |
        # Crear un archivo temporal para almacenar el resultado
        tmpfile=$(mktemp)

        # Procesar el archivo con awk para comentar la segunda ocurrencia de <sessionState> y </sessionState>
        awk '
        BEGIN {
            inside_comment = 0;
            count_open = 0;
            count_close = 0;
        }
        {
            # Detectar inicio de bloque comentado
            if (/<\!--.*<sessionState/) {
                inside_comment = 1;
            }
            
            # Detectar fin de bloque comentado
            if (/sessionState>.*-->/) {
                inside_comment = 0;
            }
            
            # Contar y comentar la segunda ocurrencia de <sessionState> fuera de bloques comentados
            if (!inside_comment && /<sessionState/) {
                count_open++;
                if (count_open == 2) {
                    sub(/<sessionState/, "<!-- <sessionState");
                }
            }
            
            # Contar y comentar la segunda ocurrencia de </sessionState> fuera de bloques comentados
            if (!inside_comment && /<\/sessionState>/) {
                count_close++;
                if (count_close == 2) {
                    sub(/<\/sessionState>/, "sessionState> -->");
                }
            }
            
            # Imprimir la lÃ­nea modificada o no modificada
            print $0;
        }
        ' web3.config > "$tmpfile"

        # Reemplazar el archivo original con el archivo temporal
        mv "$tmpfile" web3.config

    - name: Upload modified web.config
      uses: actions/upload-artifact@v2
      with:
        name: web3.config
        path: web3.config
