name: Real Comentar web.config

on:

  workflow_dispatch: #

jobs:
  modificar-webconfig:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Run script to modify web.config
      run: |
        tmpfile=$(mktemp)

        # Procesar el archivo y marcar las l√≠neas con la segunda ocurrencia de <sessionState y </sessionState>
        awk '
          {
            if (/<!-- *<sessionState/) {
              skip_open++;
            }
            if (/<\/sessionState> *-->/) {
              skip_close++;
            }
            if (/[^-] *<sessionState/ && skip_open == 0) {
              count_open++;
              if (count_open == 2) {
                print "<!-- " $0;
                next;
              }
            }
            if (/[^-] *<\/sessionState/ && skip_close == 0) {
              count_close++;
              if (count_close == 2) {
                print $0 " -->";
                next;
              }
            }
            print;
          }
        ' web3.config > "$tmpfile"

        # Reemplazar el archivo original con el archivo temporal
        mv "$tmpfile" web3.config

    - name: Upload modified web.config
      uses: actions/upload-artifact@v2
      with:
        name: web3.config
        path: web3.config
