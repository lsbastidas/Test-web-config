name: Real Comentar web.config

on:

  workflow_dispatch: #

jobs:
  modificar-webconfig:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Run script to modify web.config
      run: |
        # Crear un archivo temporal para almacenar el resultado
        tmpfile=$(mktemp)

        # Variable para detectar si estamos dentro de un bloque ya comentado
        inside1_comment=0
        inside2_comment=0

        # Procesar el archivo con awk para comentar las líneas necesarias
        awk '
        {
            # Buscar inicio de bloque comentado
            if (/<\!--.*<sessionState/) {
                inside1_comment = 1
            }
            
            # Buscar fin de bloque comentado
            if (/sessionState>.*-->/) {
                inside2_comment = 1
            }
            
            # Comentar las líneas que no están dentro de un bloque comentado
            if (!inside1_comment && /<sessionState/) {
                gsub(/<sessionState/, "<!-- <sessionState")
            }
            
            if (!inside2_comment && /sessionState>/) {
                gsub(/sessionState>/, "sessionState> -->")
            }
            
            # Imprimir la línea modificada o no modificada
            print $0
        }
        ' web3.config > "$tmpfile"

        # Reemplazar el archivo original con el archivo temporal
        mv "$tmpfile" web3.config
    - name: Upload modified web.config
      uses: actions/upload-artifact@v2
      with:
        name: web3.config
        path: web3.config
